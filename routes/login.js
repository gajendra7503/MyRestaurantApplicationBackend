var mysql = require('mysql');
var db=require('../db');
var jwt=require('jsonwebtoken');


var express=require('express');
var router =express.Router();

var bodyParser = require('body-parser');
var SMScontroller = require('../SMS');
const bcrypt = require('bcryptjs');

router.use(bodyParser.urlencoded({ extended: true }));

router.use(bodyParser.json());


router.post('/',(req, res)=>{
    res.send('this is login page');
    console.log('this is login');
})

router.post('/logins',(req,res)=>{

console.log(req.body.email);
console.log(req.body.password);
  db.query(`SELECT * FROM users WHERE email='${req.body.email}' AND password='${req.body.password}'`, (err, result)=>{
    if(err) {
      console.log(err);
    }
    if(!result.length){
      return res.json({
        status:"False",
        message : "email or password incorrect"
      })
    }else {
      let token = jwt.sign({ data: result }, 'my-secret-key', {expiresIn: 200});
      SMScontroller.WelcomeMail(req.body.email);
       var response = {
        message: 'Login successful',
        data: result,
        token: token,
        status:"Success",
      }
      res.send(response)
    }
  });
  // SMScontroller.WelcomeMail(req.body.email);
  //     return res.json({
  //       status:"Success",
  //       msg : "right credential"

})




module.exports = router;




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































